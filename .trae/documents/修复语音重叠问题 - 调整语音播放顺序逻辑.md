## 修复语音重叠问题的计划

### 问题总结
1. **遇敌语音重叠**：enemy_attack_warning 和敌人介绍音频同时播放
2. **加法语音过早**：问题音频在骰子动画完成前播放
3. **命中+死亡语音重叠**：hit_enemy 和 defeat_enemy 同时播放

### 修复步骤

#### 1. 增强 AudioManager - 添加序列播放能力
- 在 `AudioManager.ts` 中改进现有方法
- 确保 `playSequence` 方法正确工作
- 添加 `playEventAsync` 异步方法用于等待音频完成

#### 2. 修复遇敌语音顺序 (gameStore.ts + CombatSystem.tsx)
- 移除 `movePlayer` 中的 `audioManager.playEvent('enemy_attack_warning')`
- 在 `startCombat` 中添加逻辑：
  - 先播放 enemy_attack_warning
  - 等待完成后才设置 isPlayingIntro: false
  - VersusScreen 的敌人介绍音频在警告播放完后才播放

#### 3. 修复加法语音时机 (DiceRoller.tsx + gameStore.ts + CombatSystem.tsx)
- 在 `DiceRoller.tsx` 添加 `onRollComplete` 回调属性
- 在 `gameStore.ts` 的 `rollDiceAndGenerateQuestion` 中移除音频播放
- 在 `CombatSystem.tsx` 中监听骰子完成事件，完成后调用 `audioManager.playQuestion`

#### 4. 修复命中和死亡语音顺序 (gameStore.ts)
- 在命中敌人时，使用 `audioManager.playEventAsync('hit_enemy')` 等待完成
- 在 await 完成后才判断敌人是否死亡
- 如果死亡，再播放 `defeat_enemy` 音频

#### 5. 修复其他可能的重叠
- 检查所有 `audioManager.playEvent` 调用
- 确保连续的事件使用序列播放或 await 异步版本